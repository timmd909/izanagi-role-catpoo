---

- name: "Install lxde desktop"
  apt: name=lxde state=present

- name: "Install LightDM"
  apt: name=lightdm state=present

- name: "Configure LightDM"
  become: yes
  become_user: root
  template:
    src: etc/lightdm/lightdm.conf.j2
    dest: /etc/lightdm/lightdm.conf

- name: "Make sure LightDM is enabled in default runlevel"
  service:
    enabled: yes
    runlevel: 3
    name: lightdm

- name: "Install GNU Krell monitors"
  apt: name=gkrellm state=present

#
# XInput
#

- name: "Install XInput"
  apt: name=xinput

- name: "Make sure xorg configuration symlink is in place"
  file:
    path: /etc/X11/xorg.conf.d
    force: yes
    state: link
    src: /usr/share/X11/xorg.conf.d

- name: "Update touchscreen calibration"
  template:
    dest: /etc/X11/xorg.conf.d/99-calibration.conf
    src: etc/X11/xorg.conf.d/99-calibration.conf.j2

- name: "Install XInput calibration software"
  git:
    accept_hostkey: yes
    clone: yes
    dest: "/usr/local/src/xinput_calibrator/"
    recursive: yes
    repo: "https://github.com/tias/xinput_calibrator.git"
    version: v0.7.5

- name: "Autogen XInput calibrator"
  shell: "./autogen.sh"
  args:
    chdir: "/usr/local/src/xinput_calibrator/"
    creates: "/usr/local/src/xinput_calibrator/Makefile"

- name: "Compile XInput calibrator"
  shell: "make"
  args:
    chdir: "/usr/local/src/xinput_calibrator/"
    creates: "/usr/local/src/xinput_calibrator/src/xinput_calibrator"

- name: "Install XInput calibrator"
  become: yes
  become_user: root
  shell: make install
  args:
    chdir: "/usr/local/src/xinput_calibrator/"
    creates: "/usr/local/bin/xinput_calibrator"

#
# Kiosk mode
#
- name: "Install x11-xserver-utils"
  apt: name=x11-xserver-utils state=present

- name: "Install Chromium"
  apt: name=chromium-browser state=present

- name: Configure LXDE global defaults
  template:
    src: etc/xdg/lxsession/LXDE/autostart.j2
    dest: /etc/xdg/lxsession/LXDE/autostart

- name: Configure LXDE user defaults
  template:
    src: etc/xdg/lxsession/LXDE/autostart.j2
    dest: "{{ ansible_env.HOME }}/.config/lxsession/LXDE/autostart"
